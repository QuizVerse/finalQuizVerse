import { useState } from "react";
import {
  Rating,
  TextField,
  Dialog,
  DialogTitle,
  DialogContent,
  DialogActions,
  Button,
  DialogContentText,
} from "@mui/material";

export default function Review({ open, onClose, bookId }) {
  const [value, setValue] = useState(2);
  const [reviewText, setReviewText] = useState("");

  const handleSubmit = async () => {
    const reviewData = {
      book_id: bookId,
      rating: value,
      review_text: reviewText,
    };

    // 백엔드로 데이터 전송
    const response = await fetch("/api/reviews", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(reviewData),
    });

    if (response.ok) {
      // 성공적으로 저장된 경우
      alert("후기가 성공적으로 저장되었습니다!");
      onClose();
    } else {
      // 에러 처리
      alert("후기 저장에 실패했습니다. 다시 시도해주세요.");
    }
  };

  return (
    <Dialog open={open} onClose={onClose} fullWidth maxWidth="sm">
      <DialogTitle className="text-center font-bold text-2xl my-8 mt-12">
        시험 응시를 종료합니다
      </DialogTitle>
      <DialogContentText className="text-center">
        문제에 대해 한줄평을 남겨주세요!
      </DialogContentText>
      <DialogContent>
        <div className="p-6 space-y-4">
          <Rating
            name="simple-controlled"
            value={value}
            onChange={(event, newValue) => {
              setValue(newValue);
            }}
          />
          <div>
            <TextField
              id="standard-multiline-static"
              label="평가 내용"
              multiline
              placeholder="솔직한 후기를 적어주세요"
              variant="standard"
              fullWidth
              value={reviewText}
              onChange={(e) => setReviewText(e.target.value)}
            />
          </div>
        </div>
      </DialogContent>
      <DialogActions className="flex justify-center w-full">
        <Button onClick={onClose} className="mr-2">
          다음에 하기
        </Button>
        <Button onClick={handleSubmit} variant="contained" color="primary">
          제출하기
        </Button>
      </DialogActions>
    </Dialog>
  );
}
